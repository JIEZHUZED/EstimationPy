

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>First-Order system &mdash; EstimationPy 0.1a documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/EstimationPy_logo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="EstimationPy 0.1a documentation" href="../../index.html"/>
        <link rel="up" title="Examples" href="../examples.html"/>
        <link rel="next" title="Fault detection for a valve" href="fdd_for_valve.html"/>
        <link rel="prev" title="Examples" href="../examples.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> EstimationPy
          

          
            
            <img src="../../_static/EstimationPy_logo_small.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fmu_utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ukf.html">Unscented Kalman Filter and Smoother</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">First-Order system</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-a-simulation">Run a simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-multiple-simulations">Run multiple simulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-estimation">State estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="fdd_for_valve.html">Fault detection for a valve</a></li>
<li class="toctree-l2"><a class="reference internal" href="building.html">Building internal mass temperature estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="chiller.html">Chiller</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequenty Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications and articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../legal.html">Copyright notice</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">EstimationPy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../examples.html">Examples</a> &raquo;</li>
      
    <li>First-Order system</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/modules/examples/first_order.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="first-order-system">
<h1>First-Order system<a class="headerlink" href="#first-order-system" title="Permalink to this headline">¶</a></h1>
<p>The example demonstrates how to use <strong>estimationpy</strong> to run simulations,
pools of simulations in parallel, and solve a state estimation problem.
The examples investigated here uses the following LTI
system described by equations</p>
<div class="math">
\[\begin{split}\dot{x}(t) &amp;= ax(t) + bu(t),\\
      y(t) &amp;= cx(t) + du(t),\\
      x(t_0)&amp;= x_0\end{split}\]</div>
<p>where <span class="math">\(x_0=2\)</span>, <span class="math">\(a=-1\)</span>, <span class="math">\(b=2.5\)</span>, <span class="math">\(c=3\)</span>, and <span class="math">\(d=0.1\)</span>.</p>
<p>The model can be written in Modelica as</p>
<div class="highlight-modelica"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kr">within</span> <span class="nn">FmuExamples</span><span class="p">;</span>
<span class="kr">model</span> <span class="nc">FirstOrder</span> <span class="s2">&quot;Model of a linear SISO first order system&quot;</span>
  <span class="kr">output</span> <span class="nb">Real</span> <span class="n">x</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="s2">&quot;State variable of the system&quot;</span><span class="p">;</span>
  <span class="kr">input</span> <span class="nb">Real</span> <span class="n">u</span> <span class="s2">&quot;Input variable&quot;</span><span class="p">;</span>
  <span class="kr">output</span> <span class="nb">Real</span> <span class="n">y</span> <span class="s2">&quot;Output of the system&quot;</span><span class="p">;</span>
  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="s2">&quot;A coefficient of the SISO linear system&quot;</span>
    <span class="kr">annotation</span><span class="p">(</span><span class="n">Fixed</span><span class="o">=</span><span class="kc">false</span><span class="p">);</span>
  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="s2">&quot;B coefficient of the SISO linear system&quot;</span>
    <span class="kr">annotation</span><span class="p">(</span><span class="n">Fixed</span><span class="o">=</span><span class="kc">false</span><span class="p">);</span>
  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="s2">&quot;C coefficient of the SISO linear system&quot;</span>
    <span class="kr">annotation</span><span class="p">(</span><span class="n">Fixed</span><span class="o">=</span><span class="kc">false</span><span class="p">);</span>
  <span class="kr">parameter</span> <span class="nb">Real</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="s2">&quot;D coefficient of the SISO linear system&quot;</span>
    <span class="kr">annotation</span><span class="p">(</span><span class="n">Fixed</span><span class="o">=</span><span class="kc">false</span><span class="p">);</span>
<span class="kr">equation</span>
  <span class="kr">der</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">u</span><span class="p">;</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="n">u</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">FirstOrder</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>and can be exported as a Functional Mockup Unit (FMU).
This model has been exported using Dymola (Linux version, both 32 and 64 bits)
and is located in the project folder.</p>
<div class="section" id="run-a-simulation">
<h2>Run a simulation<a class="headerlink" href="#run-a-simulation" title="Permalink to this headline">¶</a></h2>
<p>The first example shows how to run a simple simulation
using the FMU model.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">estimationpy_logging</span><span class="o">.</span><span class="n">configure_logger</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">log_level_console</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">log_level_file</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;64-bit architecture&quot;</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;FMUs&quot;</span><span class="p">,</span> <span class="s">&quot;FirstOrder_64bit.fmu&quot;</span><span class="p">)</span>
    
    <span class="c"># Show the outputs</span>
    <span class="k">print</span> <span class="s">&quot;The names of the FMU outputs are:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">get_output_names</span><span class="p">(),</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    
    <span class="c"># Set the CSV file associated to the input</span>
    <span class="n">inputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="s">&quot;SimulationData_FirstOrder.csv&quot;</span><span class="p">)</span>
    <span class="n">input_u</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_input_by_name</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">open_csv</span><span class="p">(</span><span class="n">inputPath</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">set_selected_column</span><span class="p">(</span><span class="s">&quot;system.u&quot;</span><span class="p">)</span>
    
    <span class="c"># Initialize the model for the simulation</span>
</pre></div>
</td></tr></table></div>
<p>The model is instantiated in line 2, then at line 5 the path of the
FMU file is provided.
The input data is located in a CSV file called <code class="docutils literal"><span class="pre">SimulationData_FirstOrder.csv</span></code>.
First the input of the model is selected by its name <code class="docutils literal"><span class="pre">u</span></code>, and its reference
is the object <code class="docutils literal"><span class="pre">input_u</span></code>.
After, the CSV file is associated to the input variable (line 10), and the
name of the column is indicated in line 11.</p>
<p>The instructions at line 14 and 17 respectively initialize the model, and run the
simulation. The simulation command does not have arguments thus the time model
is simulated for the time period specified in the CSV file.
The figure below shows the result.</p>
<img alt="../../_images/FirstOrder.png" src="../../_images/FirstOrder.png" />
</div>
<div class="section" id="run-multiple-simulations">
<h2>Run multiple simulations<a class="headerlink" href="#run-multiple-simulations" title="Permalink to this headline">¶</a></h2>
<p>The second example shows how to run a pool of models that use
all the same FMU model.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">estimationpy.fmu_utils</span> <span class="kn">import</span> <span class="n">estimationpy_logging</span>
<span class="n">estimationpy_logging</span><span class="o">.</span><span class="n">configure_logger</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">log_level_console</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">log_level_file</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;32-bit architecture&quot;</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;FMUs&quot;</span><span class="p">,</span> <span class="s">&quot;FirstOrder.fmu&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;64-bit architecture&quot;</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;FMUs&quot;</span><span class="p">,</span> <span class="s">&quot;FirstOrder_64bit.fmu&quot;</span><span class="p">)</span>

    <span class="c"># Assign an existing FMU to the model</span>
    <span class="n">m</span><span class="o">.</span><span class="n">re_init</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>

    <span class="c"># Set the CSV file associated to the input</span>
    <span class="n">inputPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="s">&quot;SimulationData_FirstOrder.csv&quot;</span><span class="p">)</span>
    <span class="n">input_u</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_input_by_name</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">open_csv</span><span class="p">(</span><span class="n">inputPath</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">set_selected_column</span><span class="p">(</span><span class="s">&quot;system.u&quot;</span><span class="p">)</span>
    
<span class="hll">    <span class="c"># Select the states to be modified</span>
</span><span class="hll">    <span class="n">m</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_variable_object</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">))</span>
</span>
    <span class="c"># Initialize the simulator</span>
    <span class="n">m</span><span class="o">.</span><span class="n">initialize_simulator</span><span class="p">()</span>

    <span class="c"># Instantiate the pool</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">FmuPool</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">processes</span> <span class="o">=</span> <span class="n">n_proc</span><span class="p">)</span>

    <span class="c"># define the vector of initial conditions for which the simulations</span>
    <span class="c"># have to be performed.</span>
    <span class="c"># values has to be a list of state vectors</span>
    <span class="c"># values = [ [x0_0], [x0_1], ... [x0_n]]</span>
<span class="hll">    <span class="n">vector_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span class="hll">    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>
</td></tr></table></div>
<p>In this case the only difference with respect tp the previosu case is that instead
of calling directly the <a class="reference internal" href="../fmu_utils/model.html#estimationpy.fmu_utils.model.Model.simulate" title="estimationpy.fmu_utils.model.Model.simulate"><code class="xref py py-func docutils literal"><span class="pre">estimationpy.fmu_utils.model.Model.simulate()</span></code></a> method,
we define a <a class="reference internal" href="../fmu_utils/fmu_pool.html#estimationpy.fmu_utils.fmu_pool.FmuPool" title="estimationpy.fmu_utils.fmu_pool.FmuPool"><code class="xref py py-class docutils literal"><span class="pre">estimationpy.fmu_utils.fmu_pool.FmuPool</span></code></a> object.
Then in lines 26-30 we create 10 different initial conditions for the
state vector, and in line 33 we run the simulation. The Figure below shows
the results of the 10 different simulations that are executed in parallel.</p>
<img alt="../../_images/FirstOrderPool.png" src="../../_images/FirstOrderPool.png" />
</div>
<div class="section" id="state-estimation">
<h2>State estimation<a class="headerlink" href="#state-estimation" title="Permalink to this headline">¶</a></h2>
<p>The third example shows how to solve a state estimation problem with
estimationpy and an FMU model. Please note that in this example the model
used by the state estimation algorithm has been parametrized with values
for <span class="math">\(a\)</span>, <span class="math">\(b\)</span>, <span class="math">\(c\)</span>, and <span class="math">\(d\)</span> that are different from
the ones that were used to generate the measurements. This different represents
a case of model mismatch between the real system and its model.</p>
<p>In this case we have access to a set of measurements and we desire to estimate
the unknown state of the model. We have available a measurement of the input variable
<span class="math">\(u(t)\)</span> corrupted by noise <span class="math">\(u_m(t)\)</span>. Similarly, we don&#8217;t know the exact
value of the output <span class="math">\(y(t)\)</span> but we have a measure of it <span class="math">\(y_m(t)\)</span>.
The state estimation algorithm, implemented using an Unscented Kalman Filter,
uses these measurements together with the model to estimate the probability
distribution of the state variable <span class="math">\(x(t)\)</span> and of the output <span class="math">\(y(t)\)</span>.
We indicates the estimated values with a hat, <span class="math">\(\hat{x}(t)\)</span> and
<span class="math">\(\hat{y}(t)\)</span>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;64-bit architecture&quot;</span>
    
    <span class="c"># Path of the csv file containing the data series</span>
    <span class="n">csvPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;..&quot;</span><span class="p">,</span> <span class="s">&quot;modelica&quot;</span><span class="p">,</span> <span class="s">&quot;FmuExamples&quot;</span><span class="p">,</span> <span class="s">&quot;Resources&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="s">&quot;NoisySimulationData_FirstOrder.csv&quot;</span><span class="p">)</span>
    
    <span class="c"># Set the CSV file associated to the input, and its covariance</span>
    <span class="n">input_u</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_input_by_name</span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">open_csv</span><span class="p">(</span><span class="n">csvPath</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">set_selected_column</span><span class="p">(</span><span class="s">&quot;system.u&quot;</span><span class="p">)</span>
    <span class="n">input_u</span><span class="o">.</span><span class="n">set_covariance</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    
    <span class="c"># Set the CSV file associated to the output, and its covariance</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_output_by_name</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">open_csv</span><span class="p">(</span><span class="n">csvPath</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">get_csv_reader</span><span class="p">()</span><span class="o">.</span><span class="n">set_selected_column</span><span class="p">(</span><span class="s">&quot;system.y&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">set_measured_output</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">set_covariance</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    
    <span class="c"># Select the states to be identified, and add it to the list</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">get_variable_object</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">))</span>
    
    <span class="c"># Set initial value of state, and its covariance and the limits (if any)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">set_real</span><span class="p">(</span><span class="n">par_c</span><span class="p">,</span> <span class="mf">3.01419707</span><span class="p">)</span>
    <span class="n">par_d</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">get_variable_object</span><span class="p">(</span><span class="s">&quot;d&quot;</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">set_real</span><span class="p">(</span><span class="n">par_d</span><span class="p">,</span> <span class="mf">0.06112703</span><span class="p">)</span>
    
    <span class="c"># Initialize the model for the simulation</span>
    <span class="n">m</span><span class="o">.</span><span class="n">initialize_simulator</span><span class="p">()</span>
    
    <span class="c"># instantiate the UKF for the FMU</span>
    <span class="n">ukf_FMU</span> <span class="o">=</span> <span class="n">UkfFmu</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    
</pre></div>
</td></tr></table></div>
<p>The code snippet shows how this problemis solved. As in the previous cases
we associate a column of the CSV file (in this case a CSV file with noisy
data) to the input <code class="docutils literal"><span class="pre">u</span></code> of the FMU model (lines 4-7).
However in this case we also need to specify which is the measured output, and we
which measured data is associated to it. Also, we can specify the covariance
of this data that can be seen as a proxy of the data quality.</p>
<p>After, in line 17, we specify that the model is used for estimating one state variable,
whose name is <code class="docutils literal"><span class="pre">x</span></code>. In lines 20-24 we provide details for the state variable
to estimate</p>
<ul class="simple">
<li>initial value <span class="math">\(x_0 = 1.5\)</span>,</li>
<li>covariance <span class="math">\(\sigma^2 = 0.5\)</span>,</li>
<li>lower constraint <span class="math">\(x_{min} = 0\)</span></li>
</ul>
<p>As before we initialize the simulator (line 26), and then we instantiate an
object of type <code class="xref py py-class docutils literal"><span class="pre">estimationpy.ukf.ufk_fmu.UfkFmu</span></code>.
At the end, at line 34, we start the filter and we specify its start and stop
time by providing two datetime objects. Please not that their time zone
is set to UTC.</p>
<p>The first plot shows the input data (blue dots) used by the UKF, and the measured
output data (green dots). The blue line and the green line are the true
values that were not made available to the UKF. The red line in the bottom plot
shows the value of the estimated output variable <span class="math">\(\hat{y}(t)\)</span>, and its
confidence interval.</p>
<img alt="../../_images/FirstOrder_InputOutput.png" src="../../_images/FirstOrder_InputOutput.png" />
<p>The Figure below shows in green the unknown state variable <span class="math">\(x(t)\)</span> and
in red its estimation <span class="math">\(\hat{x}(t)\)</span>. The red area around the estimation indicates the
confidence interval of the estimation.</p>
<img alt="../../_images/FirstOrder_State.png" src="../../_images/FirstOrder_State.png" />
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fdd_for_valve.html" class="btn btn-neutral float-right" title="Fault detection for a valve" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../examples.html" class="btn btn-neutral" title="Examples" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright EstimationPy, Copyright (c) 2015, The Regents of the University of California, through Lawrence Berkeley National Laboratory (subject to receipt of any required approvals from the U.S. Dept. of Energy). All rights reserved..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>